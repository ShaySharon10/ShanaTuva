<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כרטיס ברכה לראש השנה</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round:wght@400&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap');
       
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            font-family: 'Heebo', 'Varela Round', sans-serif;
            min-height: 100vh;
            background: linear-gradient(45deg, #e0f2f1, #f3e5f5, #e8f5e8, #fff3e0, #fce4ec, #e8eaf6, #f1f8e9);
            background-size: 600% 600%;
            animation: gradientShift 10s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            direction: rtl;
            overflow-x: hidden;
            position: relative;
        }
       
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 75% 75%, rgba(156, 39, 176, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 75% 25%, rgba(255, 193, 7, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -2;
        }
       
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(2px 2px at 20px 30px, rgba(255, 215, 0, 0.4), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(156, 39, 176, 0.3), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.6), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 215, 0, 0.4), transparent),
                radial-gradient(2px 2px at 160px 30px, rgba(156, 39, 176, 0.3), transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: sparkleMove 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }
       
        @keyframes sparkleMove {
            0% { transform: translateY(0px) translateX(0px); }
            50% { transform: translateY(-10px) translateX(5px); }
            100% { transform: translateY(0px) translateX(0px); }
        }
       
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            16% { background-position: 100% 50%; }
            32% { background-position: 50% 100%; }
            48% { background-position: 0% 100%; }
            64% { background-position: 100% 0%; }
            80% { background-position: 50% 0%; }
            100% { background-position: 0% 50%; }
        }
       
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 35px;
            padding: 50px;
            text-align: center;
            box-shadow:
                0 25px 50px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 215, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            max-width: 700px;
            width: 100%;
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
            background-clip: padding-box;
            animation: cardGlow 4s ease-in-out infinite;
        }
       
        .card::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ffd700, #9c27b0, #3f51b5, #4caf50, #ff5722, #ffd700);
            background-size: 300% 300%;
            border-radius: 38px;
            z-index: -1;
            animation: borderGlow 3s linear infinite;
        }
       
        @keyframes cardGlow {
            0%, 100% {
                box-shadow:
                    0 25px 50px rgba(0, 0, 0, 0.2),
                    0 0 30px rgba(255, 215, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
            }
            50% {
                box-shadow:
                    0 30px 60px rgba(0, 0, 0, 0.25),
                    0 0 50px rgba(156, 39, 176, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9);
            }
        }
       
        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
       
        .floating-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
       
        .honey, .apple, .shofar, .pomegranate {
            position: absolute;
            opacity: 0.9;
            font-size: 32px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
            transition: all 0.3s ease;
        }
       
        .honey {
            animation: float 6s ease-in-out infinite, rotate 12s linear infinite;
            color: #ffa726;
        }
        .apple {
            animation: float 7s ease-in-out infinite 1s, pulse 3s ease-in-out infinite;
            color: #ef5350;
        }
        .shofar {
            animation: float 8s ease-in-out infinite 2s, swing 4s ease-in-out infinite;
            color: #8d6e63;
        }
        .pomegranate {
            animation: float 6.5s ease-in-out infinite 3s, bounce 2s ease-in-out infinite;
            color: #c2185b;
        }
       
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
            33% { transform: translateY(-20px) rotate(3deg) scale(1.15); }
            66% { transform: translateY(-35px) rotate(-3deg) scale(0.95); }
        }
       
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
       
        @keyframes pulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
        }
       
        @keyframes swing {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
       
        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
       
        .content {
            position: relative;
            z-index: 2;
        }
       
        .title {
            font-size: 3.2em;
            background: linear-gradient(45deg, #4a148c, #7b1fa2, #9c27b0, #e91e63, #ff5722, #ff9800, #ffd700);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-weight: 700;
            animation: titleGlow 3s ease-in-out infinite, titleMove 6s linear infinite;
            position: relative;
        }
       
        .title::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg,
                rgba(255, 215, 0, 0.3) 0%,
                rgba(156, 39, 176, 0.3) 25%,
                rgba(63, 81, 181, 0.3) 50%,
                rgba(76, 175, 80, 0.3) 75%,
                rgba(255, 215, 0, 0.3) 100%);
            border-radius: 50%;
            z-index: -1;
            animation: titleHalo 4s ease-in-out infinite;
            filter: blur(20px);
        }
       
        @keyframes titleGlow {
            0%, 100% {
                filter: drop-shadow(0 0 10px rgba(156, 39, 176, 0.4)) drop-shadow(0 0 20px rgba(255, 215, 0, 0.3));
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(156, 39, 176, 0.7)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.5));
            }
        }
       
        @keyframes titleMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
       
        @keyframes titleHalo {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }
       
        .greeting-btn {
            background: linear-gradient(45deg, #9c27b0, #673ab7, #3f51b5, #4caf50, #ff5722);
            background-size: 300% 300%;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.4em;
            border-radius: 35px;
            cursor: pointer;
            margin: 30px 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: inherit;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 10px 25px rgba(156, 39, 176, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            animation: buttonPulse 3s ease-in-out infinite;
        }
       
        .greeting-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
       
        .greeting-btn::after {
            content: '✨';
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            font-size: 1.2em;
            animation: sparkleRotate 2s linear infinite;
        }
       
        .greeting-btn:hover {
            transform: translateY(-8px) scale(1.08);
            box-shadow:
                0 20px 40px rgba(156, 39, 176, 0.6),
                0 0 50px rgba(255, 215, 0, 0.3);
            animation: none;
        }
       
        .greeting-btn:hover::before {
            left: 100%;
        }
       
        .greeting-btn:active {
            transform: translateY(-6px) scale(1.05);
        }
       
        @keyframes buttonPulse {
            0%, 100% {
                background-position: 0% 50%;
                box-shadow:
                    0 10px 25px rgba(156, 39, 176, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% {
                background-position: 100% 50%;
                box-shadow:
                    0 15px 35px rgba(156, 39, 176, 0.5),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }
       
        @keyframes sparkleRotate {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }
       
        .greeting-text {
            font-size: 1.4em;
            color: #7b1fa2;
            margin: 25px 0;
            line-height: 1.7;
            min-height: 80px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(156, 39, 176, 0.05);
            border: 2px solid rgba(156, 39, 176, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
       
        .greeting-text.show {
            opacity: 1;
            transform: translateY(0);
        }
       
        .scratch-section {
            margin-top: 40px;
            padding: 30px;
            background: rgba(240, 240, 240, 0.6);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
       
        .scratch-title {
            font-size: 1.5em;
            color: #4a148c;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .scratch-wrap {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 140px;
            margin: 25px auto;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            background: linear-gradient(135deg, #fff, #f8fafc);
            border: 3px solid #ffd700;
        }
       
        .surprise-text {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            font-size: 1.2em;
            color: #4a148c;
            line-height: 1.5;
            font-weight: 600;
            z-index: 0;
        }
       
        canvas#scratch {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            cursor: crosshair;
            z-index: 1;
        }
       
        .new-scratch-btn {
            background: linear-gradient(45deg, #26a69a, #42a5f5, #66bb6a);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: inherit;
            font-weight: 600;
        }
       
        .new-scratch-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 20px rgba(38, 166, 154, 0.4);
        }
       
        .progress-indicator {
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
            opacity: 0;
            transition: opacity 0.3s;
        }
       
        .progress-indicator.show {
            opacity: 1;
        }
       
        @media (max-width: 768px) {
            .card { padding: 25px; margin: 10px; }
            .title { font-size: 2.2em; }
            .greeting-text { font-size: 1.2em; }
            .scratch-title { font-size: 1.3em; }
            .scratch-wrap { height: 120px; }
            .floating-elements .honey, .apple, .shofar, .pomegranate { font-size: 22px; }
        }
       
        .sparkle {
            position: absolute;
            color: #ffd700;
            font-size: 15px;
            pointer-events: none;
            animation: sparkle 2s linear infinite;
            z-index: 9999;
        }
       
        @keyframes sparkle {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
       
        @keyframes firework {
            0% {
                opacity: 1;
                transform: scale(0) rotate(0deg) translateY(0);
            }
            25% {
                opacity: 1;
                transform: scale(1.5) rotate(90deg) translateY(-20px);
            }
            50% {
                opacity: 1;
                transform: scale(1.8) rotate(180deg) translateY(-40px);
            }
            75% {
                opacity: 0.7;
                transform: scale(2) rotate(270deg) translateY(-30px);
            }
            100% {
                opacity: 0;
                transform: scale(0) rotate(360deg) translateY(20px);
            }
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="honey" style="top: 8%; right: 12%; animation-delay: 0s;">🍯</div>
        <div class="apple" style="top: 18%; left: 8%; animation-delay: 1s;">🍎</div>
        <div class="shofar" style="top: 25%; right: 85%; animation-delay: 2s;">📯</div>
        <div class="pomegranate" style="top: 45%; left: 85%; animation-delay: 2.5s;">🍇</div>
        <div class="honey" style="top: 65%; right: 6%; animation-delay: 3s;">🍯</div>
        <div class="apple" style="top: 75%; left: 15%; animation-delay: 4s;">🍎</div>
        <div class="shofar" style="top: 85%; right: 75%; animation-delay: 4.5s;">📯</div>
        <div class="pomegranate" style="top: 12%; left: 75%; animation-delay: 5s;">🍇</div>
    </div>

    <div class="card">
        <div class="content">
            <h1 class="title">🍯 שנה טובה ומתוקה! 🍎</h1>
           
            <button class="greeting-btn" onclick="generateGreeting()">✨ צור ברכה אישית ✨</button>
           
            <div class="greeting-text" id="greetingText"></div>
           
            <div class="scratch-section">
                <div class="scratch-title">🔮 רוצה לגלות מה מחכה לך השנה? 🔮</div>

                <div class="scratch-wrap" id="scratchWrap">
                    <div class="surprise-text" id="surpriseText"></div>
                    <canvas id="scratch" width="600" height="140"></canvas>
                </div>
               
                <div class="progress-indicator" id="progressIndicator">גרדו בעדינות לגילוי הפתעה...</div>

                <button class="new-scratch-btn" onclick="newScratchCard()">🎲 כרטיס חדש</button>
            </div>
        </div>
    </div>

    <script>
        const greetings = [
            "שתהיה לך שנה מלאה בשמחות והצלחות בכל תחום שתבחר לפעול בו.",
            "שהשנה החדשה תביא בריאות טובה, שלווה פנימית ושפע של חוויות נעימות ומעשירות.",
            "ששנה חדשה תהיה מלאה בהגשמה אישית ומקצועית, עם הרבה סיפוק בעשייה.",
            "שהשנה החדשה תאיר את דרכך באור של הזדמנויות חדשות וצמיחה מתמדת.",
            "שהשנה החדשה תהיה מלאת אהבה, כבוד הדדי וחיבורים משמעותיים עם הסובבים אותך.",
            "שהשנה הקרובה תביא לך שקט נפשי, שמחות קטנות והצלחות גדולות.",
            "שהשנה החדשה תהפוך לשנה של הגשמת חלומות ישנים וליצירת חוויות חדשות ומרגשות.",
            "שהשנה תיתן לך כוח להתמודד עם אתגרים והשראה ליצור ולהתפתח.",
            "שנה מלאה ברגעים קטנים של אושר, חיוכים ומפגשים נעימים שיחממו את הלב.",
            "שהשנה החדשה תאיר את חייך בשפע, בריאות והצלחות בכל תחום שחשוב לך.",
            "שתזכה השנה לראות את הפירות של המאמצים שלך ולהרגיש סיפוק עמוק מהדרך.",
            "שהשנה תביא איתה הרבה צחוק, אהבה והרבה רגעי קסם שיישארו איתך לתמיד."
        ];
       
        const surpriseMessages = [
            "🌟 השנה תמצא רעיון קטן שהופך לפרויקט גדול שמעורר השראה סביבך!",
            "💫 השנה מפגש מקרי יוביל להזדמנות מדהימה שלא חלמת עליה!",
            "✨ השנה אדם מיוחד יכנס לחייך ויחולל שינוי חיובי ומשמעותי!",
            "🎯 השנה חלום ישן שנשכח יתחיל להסתדר בצורה מפתיעה ונפלאה!",
            "🚀 השנה תגלה כישרון חבוי בתוכך שיפתח דלתות חדשות!",
            "🌈 השנה רגע קטן של אומץ יפתח דלת להרפתקה מדהימה!",
            "📞 השנה שיחה או הודעה מהעבר תשנה את הכיוון שלך לטובה!",
            "🌱 השנה תהליך של התפתחות אישית יוליד חיבורים בלתי צפויים!",
            "💡 השנה רעיון שנראה מוזר בהתחלה יתגלה כפתרון גאוני!",
            "🎨 השנה תביא השראה בדברים קטנים שיובילו לשינוי גדול!",
            "🔑 השנה תגלה שהמפתח להצלחה היה בידיים שלך כל הזמן!",
            "🌟 השנה תפגוש מישהו שישנה את הדרך שבה את/ה רואה את העולם!"
        ];

        function randomPick(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.innerHTML = '✨';
            sparkle.style.left = x + 'px';
            sparkle.style.top = y + 'px';
            document.body.appendChild(sparkle);
           
            setTimeout(() => {
                document.body.removeChild(sparkle);
            }, 2000);
        }

        function generateGreeting() {
            const randomGreeting = randomPick(greetings);
            const greetingElement = document.getElementById('greetingText');
           
            greetingElement.innerHTML = randomGreeting + '<br><br>🕊️ חג שמח ושנה טובה 🕊️<br>שנה של ביטחון ושובם של יקירנו הביתה 🙏<br><br>מאחל מכל ה-💗<br><strong>שי יאיר שרון</strong>';
           
            greetingElement.classList.add('show');
           
            // הוספת נצנוצים
            for(let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createSparkle(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight
                    );
                }, i * 200);
            }
        }

        // מנגנון גרד-וגלה משופר
        const scratchWrap = document.getElementById('scratchWrap');
        const scratchCanvas = document.getElementById('scratch');
        const ctx = scratchCanvas.getContext('2d');
        const progressIndicator = document.getElementById('progressIndicator');

        function setSurprise(text) {
            document.getElementById('surpriseText').textContent = text;
        }

        function mmToCssPx(mm) {
            return mm * (96/25.4);
        }

        let isDrawing = false;
        let totalPixels = 0;
        let lastPos = null;

        function initScratchLayer() {
            const rect = scratchWrap.getBoundingClientRect();
            scratchCanvas.width = Math.max(1, Math.floor(rect.width));
            scratchCanvas.height = Math.max(1, Math.floor(rect.height));

            ctx.globalCompositeOperation = 'source-over';
           
            // שכבת כסף מעוצבת יותר
            const g = ctx.createRadialGradient(
                scratchCanvas.width/2, scratchCanvas.height/2, 0,
                scratchCanvas.width/2, scratchCanvas.height/2, scratchCanvas.width/2
            );
            g.addColorStop(0, '#f5f5f5');
            g.addColorStop(0.4, '#e0e0e0');
            g.addColorStop(0.8, '#d0d0d0');
            g.addColorStop(1, '#c0c0c0');
            ctx.fillStyle = g;
            ctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);

            // נצנוצים מעודנים יותר
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            for(let i = 0; i < 200; i++) {
                const x = Math.random() * scratchCanvas.width;
                const y = Math.random() * scratchCanvas.height;
                const size = Math.random() * 2 + 0.5;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }

            // טקסט על השכבה
            ctx.fillStyle = 'rgba(106,27,154,0.4)';
            ctx.font = 'bold 24px Heebo, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('🪙 גרדו כאן בעדינות 🪙', scratchCanvas.width/2, scratchCanvas.height/2);

            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineWidth = mmToCssPx(5);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            totalPixels = scratchCanvas.width * scratchCanvas.height;
            scratchCanvas.style.pointerEvents = 'auto';
            scratchCanvas.style.opacity = '1';
            scratchCanvas.style.transition = 'none';
           
            progressIndicator.classList.add('show');
        }

        function getPosition(e) {
            const rect = scratchCanvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            return {
                x: (clientX - rect.left) * (scratchCanvas.width / rect.width),
                y: (clientY - rect.top) * (scratchCanvas.height / rect.height)
            };
        }

        function startScratch(e) {
            e.preventDefault();
            isDrawing = true;
            const p = getPosition(e);
            lastPos = p;

            ctx.beginPath();
            ctx.arc(p.x, p.y, mmToCssPx(5)/2, 0, Math.PI*2);
            ctx.fill();
            checkReveal();
        }

        function continueScratch(e) {
            if(!isDrawing) return;
            e.preventDefault();

            const p = getPosition(e);

            if(lastPos) {
                ctx.beginPath();
                ctx.moveTo(lastPos.x, lastPos.y);
                ctx.lineTo(p.x, p.y);
                ctx.stroke();
            }
            lastPos = p;
            checkReveal();
        }

        function endScratch(e) {
            if(!isDrawing) return;
            e.preventDefault();
            isDrawing = false;
            lastPos = null;
            ctx.beginPath();
        }

        function setupScratchEvents() {
            scratchCanvas.removeEventListener('mousedown', startScratch);
            scratchCanvas.removeEventListener('mousemove', continueScratch);
            scratchCanvas.removeEventListener('mouseup', endScratch);
            scratchCanvas.removeEventListener('mouseleave', endScratch);
            scratchCanvas.removeEventListener('touchstart', startScratch);
            scratchCanvas.removeEventListener('touchmove', continueScratch);
            scratchCanvas.removeEventListener('touchend', endScratch);
            scratchCanvas.removeEventListener('touchcancel', endScratch);

            scratchCanvas.addEventListener('mousedown', startScratch);
            scratchCanvas.addEventListener('mousemove', continueScratch);
            scratchCanvas.addEventListener('mouseup', endScratch);
            scratchCanvas.addEventListener('mouseleave', endScratch);

            scratchCanvas.addEventListener('touchstart', startScratch, {passive:false});
            scratchCanvas.addEventListener('touchmove', continueScratch, {passive:false});
            scratchCanvas.addEventListener('touchend', endScratch);
            scratchCanvas.addEventListener('touchcancel', endScratch);

            window.addEventListener('resize', initScratchLayer);
        }

        function checkReveal() {
            const img = ctx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
            let transparent = 0;
            for(let i = 3; i < img.data.length; i += 4) {
                if(img.data[i] === 0) transparent++;
            }
            const cleared = transparent / totalPixels;

            if(cleared > 0.75) {
                ctx.clearRect(0, 0, scratchCanvas.width, scratchCanvas.height);
                scratchCanvas.style.pointerEvents = 'none';
                progressIndicator.classList.remove('show');
               
                // אפקטים מדהימים כשמגלים את ההודעה
                createFireworks();
               
                // נצנוצים מיוחדים
                for(let i = 0; i < 12; i++) {
                    setTimeout(() => {
                        createSparkle(
                            scratchWrap.offsetLeft + Math.random() * scratchWrap.offsetWidth,
                            scratchWrap.offsetTop + Math.random() * scratchWrap.offsetHeight
                        );
                    }, i * 80);
                }
            }
        }

        function resetScratch() {
            initScratchLayer();
        }

        function newScratchCard() {
            setSurprise(randomPick(surpriseMessages));
            scratchCanvas.style.display = 'block';
            scratchCanvas.style.pointerEvents = 'auto';
            resetScratch();
            setupScratchEvents();
        }

        window.onload = function () {
            newScratchCard();
        };
    </script>
</body>
</html>
